# 🌍 Environment Setup Guide

This guide explains how to set up and manage both development and production environments for your Symfony backend.

## 📁 Environment Files

- `env.dev` - Development environment template
- `env.prod` - Production environment template
- `env.cloud` - Cloud environment template (generated by migration script)
- `env.db-setup` - Database setup configuration
- `.env.local` - Your actual environment configuration (created from templates)

## 🚀 Quick Start

### 1. Development Environment

```bash
# Switch to development environment
./switch-env.sh dev

# Build and start development environment
./build-dev.sh

# Start development server
php bin/console server:start 0.0.0.0:8000
```

### 2. Production Environment

```bash
# Switch to production environment
./switch-env.sh prod

# Build production environment
./build-prod.sh

# Start production server
APP_ENV=prod php bin/console server:start 0.0.0.0:8000
```

### 3. Cloud Environment

```bash
# Migrate to cloud database
./migrate-to-cloud.sh

# Switch to cloud environment
./switch-env.sh cloud

# Test cloud environment
APP_ENV=prod php bin/console server:start 0.0.0.0:8000
```

## 🔄 Environment Switching

Use the `switch-env.sh` script to easily switch between environments:

```bash
# Switch to development
./switch-env.sh dev

# Switch to production
./switch-env.sh prod

# Switch to cloud
./switch-env.sh cloud
```

## 🏗️ Build Scripts

### Development Build (`build-dev.sh`)
- Installs all dependencies (including dev dependencies)
- Sets up development environment
- Generates JWT keys
- Starts Docker database (if available)
- Sets up smcnary user with admin privileges
- Clears and warms up development cache
- Runs database migrations

### Production Build (`build-prod.sh`)
- Installs only production dependencies
- Sets up production environment
- Generates JWT keys
- Clears and warms up production cache
- Runs database migrations
- Sets proper file permissions

### Database User Setup (`setup-db-user.sh`)
- Creates `tulsa_seo` database
- Creates `smcnary` user with password `TulsaSeo122`
- Grants system admin privileges
- Creates system admin user in Symfony
- Tests database connectivity

### Cloud Migration (`migrate-to-cloud.sh`)
- Interactive cloud database setup
- Creates `smcnary` user on cloud database
- Updates environment files for cloud
- Runs migrations on cloud database
- Generates cloud-specific configuration

## ⚙️ Environment Variables

### Development (`env.dev`)
- `APP_ENV=dev`
- `APP_DEBUG=true`
- Local database connection
- Development OAuth URLs
- Debug logging enabled

### Production (`env.prod`)
- `APP_ENV=prod`
- `APP_DEBUG=false`
- Production database connection
- Production OAuth URLs
- Warning-level logging
- Security headers enabled

## 🗄️ Database Setup

### Development
- Uses Docker Compose Tulsa SEO database (port 5434)
- Automatically started by build script
- Local PostgreSQL instance with `tulsa_seo` database

### Production
- Requires external Tulsa SEO database connection
- Update `DATABASE_URL` in `.env.local`
- Ensure `tulsa_seo` database is accessible

## 🔑 JWT Configuration

Both environments require JWT keys:
- Private key: `config/jwt/private.pem`
- Public key: `config/jwt/public.pem`
- Passphrase: Set in environment file

Keys are automatically generated if they don't exist.

## 🚨 Security Notes

### Development
- Uses default secrets (safe for local development)
- Debug mode enabled
- Verbose logging

### Production
- **ALWAYS change default secrets**
- Update `APP_SECRET`
- Update `JWT_PASSPHRASE`
- Disable debug mode
- Use HTTPS URLs

## 🧪 Testing Environments

### Test Development
```bash
curl http://localhost:8000/api/v1/health
```

### Test Production
```bash
curl http://localhost:8000/api/v1/health
```

## 🔧 Troubleshooting

### Common Issues

1. **Permission Denied**
   ```bash
   chmod +x *.sh
   ```

2. **Database Connection Failed**
   - Check Docker is running
   - Verify database credentials
   - Ensure database is accessible

3. **JWT Keys Missing**
   ```bash
   php bin/console lexik:jwt:generate-keypair --overwrite
   ```

4. **Cache Issues**
   ```bash
   php bin/console cache:clear --env=dev
   php bin/console cache:clear --env=prod
   ```

## 📋 Environment Checklist

### Development Setup
- [ ] Run `./switch-env.sh dev`
- [ ] Update `.env.local` with credentials
- [ ] Run `./build-dev.sh`
- [ ] Start server: `php bin/console server:start 0.0.0.0:8000`
- [ ] Test API endpoint

### Production Setup
- [ ] Run `./switch-env.sh prod`
- [ ] Update `.env.local` with production credentials
- [ ] Change default secrets
- [ ] Run `./build-prod.sh`
- [ ] Start server: `APP_ENV=prod php bin/console server:start 0.0.0.0:8000`
- [ ] Test all API endpoints
- [ ] Verify security settings

## 🆘 Support

If you encounter issues:
1. Check the troubleshooting section
2. Verify environment file configuration
3. Check Symfony logs in `var/log/`
4. Ensure all dependencies are installed
